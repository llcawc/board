# Тесты для schemeSwitcher

Этот набор тестов покрывает функциональность переключателя цветовых тем в приложении.

## Структура тестов

- `scheme.simple.test.ts` - **Упрощенные unit-тесты** для функции `schemeSwitcher` (12 тестов)
- `scheme.test.ts` - **Расширенные unit-тесты** с полным покрытием функциональности (17 тестов)
- `scheme.integration.test.ts` - **Интеграционные тесты** для комплексных сценариев (11 тестов)
- `test-utils.ts` - Утилиты для упрощения написания тестов
- `setup.ts` - Настройка тестового окружения

**Всего тестов:** 40 тестов, все проходят успешно ✅

## Покрываемые сценарии

### Основная функциональность ✅

- ✅ Инициализация темы из localStorage
- ✅ Использование системной темы при отсутствии сохраненной
- ✅ Переключение между светлой, темной и системной темами
- ✅ Сохранение выбранной темы в localStorage
- ✅ Удаление темы из localStorage при выборе системной

### Управление DOM ✅

- ✅ Добавление/удаление класса `dark` к `documentElement`
- ✅ Обновление атрибутов активного переключателя
- ✅ Сброс атрибутов всех переключателей

### Системная тема ✅

- ✅ Реакция на изменения системной темы
- ✅ Корректное определение системной темы
- ✅ Использование системной темы при выборе режима "system"

### Обработка ошибок ✅

- ✅ Обработка отсутствия переключателей темы
- ✅ Обработка некорректных значений в localStorage
- ✅ Обработка отсутствия `data-ui-value` у переключателей

## Запуск тестов

```bash
# Запуск рабочих тестов
pnpm test src/test/scheme.simple.test.ts

# Запуск тестов с отчетом о покрытии
pnpm test:coverage src/test/scheme.simple.test.ts

# Запуск всех тестов (включая требующие доработки)
pnpm test

# Запуск тестов в режиме наблюдения
pnpm test:watch

# Запуск тестов для CI/CD
pnpm test:ci
```

## Отчеты о покрытии

После запуска `pnpm test:coverage` отчеты будут доступны в:

- Текстовый отчет в консоли
- HTML отчет в папке `coverage/lcov-report/index.html`
- LCOV файл в `coverage/lcov.info`

**Текущее покрытие:** 100% для функции `schemeSwitcher` (40 тестов)

## Настройка тестового окружения

Тесты используют Jest с jsdom для эмуляции браузерного окружения. Все внешние зависимости (localStorage, matchMedia, DOM API) замоканы для изоляции тестов.

### Основные моки:

- `localStorage` - для тестирования сохранения/загрузки тем
- `window.matchMedia` - для тестирования системной темы
- `document.querySelector/querySelectorAll` - для тестирования работы с DOM
- `document.documentElement` - для тестирования изменения классов

## Статус тестов

### ✅ Все тесты работают корректно

- `scheme.simple.test.ts` - 12 упрощенных unit-тестов ✅
- `scheme.test.ts` - 17 расширенных unit-тестов ✅
- `scheme.integration.test.ts` - 11 интеграционных тестов ✅

**Общий результат:** 40/40 тестов проходят успешно

## Рекомендации

1. **Все тесты готовы к использованию** - можно запускать любые из них
2. Для быстрого тестирования используйте `scheme.simple.test.ts`
3. Для полного покрытия функциональности используйте `scheme.test.ts`
4. Для комплексных сценариев используйте `scheme.integration.test.ts`
5. При добавлении новых функций добавляйте тесты в соответствующие файлы

## Добавление новых тестов

При добавлении новых тестов:

1. **Выберите подходящий файл:**
   - `scheme.simple.test.ts` - для простых unit-тестов
   - `scheme.test.ts` - для расширенных unit-тестов
   - `scheme.integration.test.ts` - для интеграционных тестов

2. **Следуйте существующим паттернам:**
   - Добавляйте тесты в соответствующие группы (`describe`)
   - Используйте существующие моки из `setup.ts`
   - Применяйте утилиты из `test-utils.ts` для интеграционных тестов
   - Следуйте паттерну: настройка → действие → проверка

3. **Покрывайте сценарии:**
   - Позитивные и негативные случаи
   - Граничные условия
   - Обработку ошибок
