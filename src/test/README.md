# Тесты для schemeSwitcher

Этот набор тестов покрывает функциональность переключателя цветовых тем в приложении.

## Структура тестов

- `scheme.simple.test.ts` - **Рабочие упрощенные тесты** для функции `schemeSwitcher` (рекомендуется)
- `scheme.test.ts` - Расширенные unit-тесты (требуют доработки моков)
- `scheme.integration.test.ts` - Интеграционные тесты (требуют доработки моков)
- `test-utils.ts` - Утилиты для упрощения написания тестов
- `setup.ts` - Настройка тестового окружения

## Покрываемые сценарии

### Основная функциональность ✅

- ✅ Инициализация темы из localStorage
- ✅ Использование системной темы при отсутствии сохраненной
- ✅ Переключение между светлой, темной и системной темами
- ✅ Сохранение выбранной темы в localStorage
- ✅ Удаление темы из localStorage при выборе системной

### Управление DOM ✅

- ✅ Добавление/удаление класса `dark` к `documentElement`
- ✅ Обновление атрибутов активного переключателя
- ✅ Сброс атрибутов всех переключателей

### Системная тема ✅

- ✅ Реакция на изменения системной темы
- ✅ Корректное определение системной темы
- ✅ Использование системной темы при выборе режима "system"

### Обработка ошибок ✅

- ✅ Обработка отсутствия переключателей темы
- ✅ Обработка некорректных значений в localStorage
- ✅ Обработка отсутствия `data-ui-value` у переключателей

## Запуск тестов

```bash
# Запуск рабочих тестов
pnpm test src/test/scheme.simple.test.ts

# Запуск тестов с отчетом о покрытии
pnpm test:coverage src/test/scheme.simple.test.ts

# Запуск всех тестов (включая требующие доработки)
pnpm test

# Запуск тестов в режиме наблюдения
pnpm test:watch

# Запуск тестов для CI/CD
pnpm test:ci
```

## Отчеты о покрытии

После запуска `pnpm test:coverage` отчеты будут доступны в:

- Текстовый отчет в консоли
- HTML отчет в папке `coverage/lcov-report/index.html`
- LCOV файл в `coverage/lcov.info`

**Текущее покрытие:** 93.18% для функции `schemeSwitcher`

## Настройка тестового окружения

Тесты используют Jest с jsdom для эмуляции браузерного окружения. Все внешние зависимости (localStorage, matchMedia, DOM API) замоканы для изоляции тестов.

### Основные моки:

- `localStorage` - для тестирования сохранения/загрузки тем
- `window.matchMedia` - для тестирования системной темы
- `document.querySelector/querySelectorAll` - для тестирования работы с DOM
- `document.documentElement` - для тестирования изменения классов

## Статус тестов

### ✅ Рабочие тесты

- `scheme.simple.test.ts` - Полностью функциональные тесты с хорошим покрытием

### ⚠️ Требуют доработки

- `scheme.test.ts` - Расширенные тесты (проблемы с моками DOM элементов)
- `scheme.integration.test.ts` - Интеграционные тесты (проблемы с моками DOM элементов)

## Рекомендации

1. **Используйте `scheme.simple.test.ts`** для текущего тестирования
2. При необходимости расширения тестов, доработайте моки в `setup.ts`
3. Добавляйте новые тесты в `scheme.simple.test.ts` для быстрого результата

## Добавление новых тестов

При добавлении новых тестов в `scheme.simple.test.ts`:

1. Добавляйте тесты в соответствующие группы (`describe`)
2. Используйте существующие моки
3. Следуйте паттерну: настройка → действие → проверка
4. Покрывайте как позитивные, так и негативные сценарии
